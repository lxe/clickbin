authosizedUser = user && user.loggedIn && typeof(profile) !== 'undefined' && profile.username === user.username || typeof(isOwner) !== 'undefined' && isOwner

mixin link(link)
  li.clearfix.link
    .well
      if authosizedUser
        a(href="/_/bin/#{bin.id}/link/#{link.id}/remove").close &times;
      a.clearfix(href=link.url, title=link.title,target="_blank",rel="nofollow")
        .minwidth.clearfix
          .icon
            if (link.icon)
              img(src="#{link.icon}")
            else if(link.mime)
              img(src="/_/images/mimetypes/" + link.mime.replace('/','-') + '.png')
            else
              .icon(style="font-size: 64px; line-height:64px")
                i.icon-warning-sign(style="width:64px;height:64px") 
          .text
            .text-container
              if (link.title)
                .title.ellipsis #{link.title}
              else
                .title.ellipsis #{link.url}
              if(link.desc)
                .url.ellipsis #{link.desc}
              else
                .url.ellipsis #{link.url}
    

mixin bin(bin)
  li.clearfix.bin
    if authosizedUser
      a(href="/_/bin/#{bin.id}/remove").close.pull-right &times;
    a.binlink.clearfix(href="#{bin.path.substr(bin.path.indexOf(':') + 1)}", title="#{bin.title}")
      .inner 
        i.icon-folder-close   
        |   #{bin.title}
   

//- .row
//-   .span6
//-     h4.icon-globe  Links
//-     ul.items.clearfix
//-       each link in bin.links
//-         mixin link(link)
//-   .span6
//-     h4.icon-folder-open  Bins
//-     ul.items
//-       each bin in children
//-         mixin bin(bin)


.bin.main.container
  if publicBin
    //- .alert(style="margin-bottom:20px;border-radius: 4px 4px 4px 4px")
    //-   i.icon-exclamation-sign 
    //-   | Your bin has now become private! only you can access it.
    div.moon
  else
    div.sun
  .row
    .span9.controls
      .clearfix
        if authosizedUser
          .row.span5
            .add-link-controls
              form.new-item-form#new-item-form(action="#{bin.path}", style="margin-bottom: 0")
                .input-append
                  button.btn(href="#")
                    //- i.icon-plus-sign 
                    | put it here
                  .item-title-container
                    input.span4.new-item-title#new-item-title(type="text", placeholder="add link or bin")
        if isOwner
          .privacy-controls
            .btn-group
              a.btn.public(href="/_/bin/#{bin.id}/public",class=bin.public?'active':''
                , data-placement="top")
                i.icon-unlock
                |  public
              a.btn.private(href="/_/bin/#{bin.id}/private",class=bin.public?'':'active'
                , rel="tooltip", data-placement="top", data-original-title="prevent others from seeing this bin")
                i.icon-lock
                |  private
    .span3.bins
      .well
        if children.length > 0
          h4 Bins
          ul.items
            each bin in children
              mixin bin(bin)
        else
          if authosizedUser
            h4 bins
            ul.items
              li.nobins
                | add a bin over there  
                i.icon-arrow-right
          else
            if bin.links.length === 0
              ul.items
                li.nobins
                  | this bin is empty
            else
              ul.items
                li.nobins 
                  | (no sub bins)
          //- li
          //-   form(action="#{bin.path}")#new-bin-form
          //-     .input-append
          //-       input.span2(type="text", placeholder="add bin")#new-bin-title
          //-       button.btn(href="#")
          //-         i.icon-plus-sign
    .span9.links
      .clearfix 
      .links
        ul.items.clearfix.row-fluid
          
          if authosizedUser && bin.links.length === 0
            li.emptybin
              | nothing here yet. add something:
          else  
            each link in bin.links
              mixin link(link)